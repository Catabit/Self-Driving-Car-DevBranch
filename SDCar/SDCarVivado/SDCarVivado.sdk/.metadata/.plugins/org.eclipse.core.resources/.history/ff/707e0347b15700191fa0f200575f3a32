#ifndef CARDQUEUE_H
#define CARDQUEUE_H

#include <stdlib.h>
#include "PN532_rfid.h"

struct card {
	uint8_t type;
	uint32_t UID;
};

struct Node {
	struct card *card;
	struct Node *next;
};

struct cardQueue {
	struct Node *head;
	struct Node *last;
};

void insertCard(struct cardQueue *q, struct card *card) {
	struct Node *newnode = malloc(sizeof(struct Node));
	newnode->card=card;
	newnode->next = NULL;

	if (q->head == NULL) {
		q->head = newnode;
		q->last = newnode;
		return;
	}
	q->last->next = newnode;
	q->last = newnode;
}

struct card *getCard(struct cardQueue *q) {
	if (q->head == NULL)
		return NULL;

	return q->head->card;
}

struct card *popCard(struct cardQueue *q) {
	if (q->head == NULL)
		return NULL;

	struct Node *result = q->head;
	q->head = q->head->next;
	return result->card;
}

void createCardQueue(struct cardQueue **q) {
	if (q != NULL)
		return;

	*q = malloc(sizeof(struct cardQueue));
	(*q)->head = NULL;
	(*q)->last = NULL;
}

void freeNodes(struct Node *node){
	if (!node)
		return;

	if(node->card)
		free(node->card);

	if(node->next)
		freeNodes(node->next);
	free(node);
}

void freeCardQueue(struct cardQueue *q){
	freeNodes(q->head);
	q->head=NULL;
	q->last=NULL;
}

#endif
